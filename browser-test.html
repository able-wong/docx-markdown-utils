<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>docx-markdown-utils Browser Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
        }
        input[type="file"] {
            margin-bottom: 10px;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .output {
            margin-top: 10px;
            padding: 10px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 3px;
            min-height: 100px;
        }
        .error {
            color: red;
            background-color: #ffe6e6;
            padding: 10px;
            border-radius: 3px;
            margin-top: 10px;
        }
        .success {
            color: green;
            background-color: #e6ffe6;
            padding: 10px;
            border-radius: 3px;
            margin-top: 10px;
        }
        pre {
            background-color: #f8f8f8;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>docx-markdown-utils Browser Test</h1>
    <p>Test the dual environment capabilities of the library in a real browser.</p>

    <div class="section">
        <h2>üìÑ Word to Markdown Converter</h2>
        <p>Upload a .docx file to convert it to Markdown using ArrayBuffer:</p>
        <input type="file" id="docxFile" accept=".docx" />
        <div id="docxStatus"></div>
        <textarea id="markdownOutput" readonly placeholder="Converted Markdown will appear here..."></textarea>
    </div>

    <div class="section">
        <h2>üìù Markdown to HTML Converter</h2>
        <p>Type Markdown text to see it converted to HTML:</p>
        <textarea id="markdownToHtmlInput" placeholder="Type Markdown here...
# Sample Heading

This is **bold** and *italic* text.

## List Example
- Item 1
- Item 2
- Item 3

## Table Example
| Header 1 | Header 2 |
|----------|----------|
| Cell 1   | Cell 2   |

## Code Example
```javascript
console.log('Hello World');
```

~~Strikethrough~~ text."></textarea>
        
        <h3>Generated HTML:</h3>
        <pre id="htmlSource"></pre>
    </div>

    <div class="section">
        <h2>üìù Markdown to Word Converter</h2>
        <p>Type Markdown text to convert it to a .docx file Blob:</p>
        <textarea id="markdownToWordInput" placeholder="Type Markdown here...
# Hello Word!

This will be converted to a .docx file."></textarea>
        <button id="convertToWord">Convert to .docx</button>
        <div id="wordStatus"></div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "unified": "https://esm.sh/unified@11",
            "remark-parse": "https://esm.sh/remark-parse@11",
            "remark-gfm": "https://esm.sh/remark-gfm@4",
            "remark-html": "https://esm.sh/remark-html@16",
            "remark-stringify": "https://esm.sh/remark-stringify@11",
            "remark-lint": "https://esm.sh/remark-lint@10",
            "remark-preset-lint-recommended": "https://esm.sh/remark-preset-lint-recommended@7",
            "rehype-parse": "https://esm.sh/rehype-parse@9",
            "rehype-remark": "https://esm.sh/rehype-remark@10",
            "mammoth": "https://esm.sh/mammoth@1.9.0",
            "node-html-parser": "https://esm.sh/node-html-parser@7",
            "@turbodocx/html-to-docx": "https://esm.sh/@turbodocx/html-to-docx@1.13.4"
        }
    }
    </script>
    <script type="module">
        try {
            // Import only the browser-compatible converters
            const { WordToMarkdownConverter } = await import('./dist/WordToMarkdownConverter.js');
            const { MarkdownToHtmlConverter } = await import('./dist/MarkdownToHtmlConverter.js');
            const { MarkdownToWordConverter } = await import('./dist/MarkdownToWordConverter.js');
            
            console.log('‚úÖ Successfully imported converters');
            
            // Initialize converters
            const wordToMdConverter = new WordToMarkdownConverter();
            const mdToHtmlConverter = new MarkdownToHtmlConverter();
            const mdToWordConverter = new MarkdownToWordConverter();
            
            // Word to Markdown functionality
            const docxFileInput = document.getElementById('docxFile');
            const docxStatus = document.getElementById('docxStatus');
            const markdownOutput = document.getElementById('markdownOutput');
            
            docxFileInput.addEventListener('change', async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const processingMessage = document.createElement('div');
                processingMessage.className = 'success';
                processingMessage.textContent = 'Processing file...';
                docxStatus.innerHTML = '';
                docxStatus.appendChild(processingMessage);
                markdownOutput.value = '';
                
                try {
                    // Convert file to ArrayBuffer (browser File API)
                    const arrayBuffer = await file.arrayBuffer();
                    console.log(`Processing ${file.name} (${arrayBuffer.byteLength} bytes)`);
                    
                    // Convert using WordToMarkdownConverter
                    const markdown = await wordToMdConverter.convert(arrayBuffer);
                    
                    markdownOutput.value = markdown;
                    const successMessage = document.createElement('div');
                    successMessage.className = 'success';
                    successMessage.textContent = `‚úÖ Successfully converted ${file.name}`;
                    docxStatus.innerHTML = '';
                    docxStatus.appendChild(successMessage);
                    
                } catch (error) {
                    console.error('Conversion error:', error);
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'error';
                    errorMessage.textContent = `‚ùå Error: ${error.message}`;
                    docxStatus.innerHTML = '';
                    docxStatus.appendChild(errorMessage);
                }
            });
            
            // Markdown to HTML functionality
            const markdownToHtmlInput = document.getElementById('markdownToHtmlInput');
            const htmlSource = document.getElementById('htmlSource');
            
            function convertMarkdownToHtml() {
                const markdown = markdownToHtmlInput.value;
                if (!markdown.trim()) {
                    htmlSource.textContent = '';
                    return;
                }
                
                try {
                    const html = mdToHtmlConverter.convert(markdown);
                    htmlSource.textContent = html;
                } catch (error) {
                    console.error('HTML conversion error:', error);
                    htmlSource.textContent = `Error: ${error.message}`;
                }
            }

            // Markdown to Word functionality
            const markdownToWordInput = document.getElementById('markdownToWordInput');
            const convertToWordButton = document.getElementById('convertToWord');
            const wordStatus = document.getElementById('wordStatus');

            convertToWordButton.addEventListener('click', async () => {
                const markdown = markdownToWordInput.value;
                if (!markdown.trim()) {
                    wordStatus.innerHTML = '<div class="error">Please enter some Markdown.</div>';
                    return;
                }

                wordStatus.innerHTML = '<div class="success">Converting...</div>';

                try {
                    const docxBlob = await mdToWordConverter.convert(markdown);
                    wordStatus.innerHTML = `<div class="success">‚úÖ Successfully created a .docx Blob. Size: ${docxBlob.size} bytes. Starting download...</div>`;
                    
                    // Create a temporary link to trigger the download
                    const url = URL.createObjectURL(docxBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'document.docx';
                    document.body.appendChild(a);
                    a.click();
                    
                    // Clean up the temporary link and URL
                    setTimeout(() => {
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    }, 0);

                } catch (error) {
                    console.error('Word conversion error:', error);
                    wordStatus.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
                }
            });
            
            // Convert on input change
            markdownToHtmlInput.addEventListener('input', convertMarkdownToHtml);
            
            // Initial conversion with placeholder text
            convertMarkdownToHtml();
            
            // Show success message
            const successBanner = document.createElement('div');
            successBanner.className = 'success';
            successBanner.textContent = '‚úÖ Library loaded successfully! All converters are ready to use.';
            document.body.insertBefore(successBanner, document.body.firstChild);
            
        } catch (error) {
            console.error('Failed to load library:', error);
            const errorBanner = document.createElement('div');
            errorBanner.className = 'error';
            errorBanner.textContent = `‚ùå Failed to load library: ${error.message}`;
            document.body.insertBefore(errorBanner, document.body.firstChild);
        }
    </script>
</body>
</html>
